<html>
<head>
    <style>
        *{margin: 0px; padding: 0px;}       
/* temporal */
.hideinBG{
    position: absolute;z-index: -1;top:0; left:0;
    height: 2200px;width:100%;}
#bgGridTemporal{
    position:relative;
    max-width: 1024px;  margin: 0px auto;
}
#bgGridTemporal div{ 
    display: inline-block; opacity: 0.3;
}
#bgGridTemporal div:nth-child(odd) {
    background-color: brown
}
#bgGridTemporal div:nth-child(even) {
    background-color:beige;
}       
#gridContainer {
    max-width: 1024px; 
    margin: 0px auto;
    background-color: rgba(0,0,0, .1);height: 100%;
}
        
/*Temporal elements*/
.tmp-Element-Form{height: 300px;}
        
/**/
.grid-row    { 
    letter-spacing: -4px;
    background-color: aliceblue; display: inline-block;}
.grid-row-sub  {
letter-spacing: -4px;    
    background-color: rgb(199, 206, 212);display: inline-block;
}
.grid-wrapper{ 
    background-color: #ff0;display: inline-block;vertical-align: top;
    letter-spacing: normal;
}
.grid-wrapper .grid-wrapper{
    background-color: #d7d700;
}
.grid-block  { 
    background-color:aquamarine;display: inline-block;
}
.grid-row, .grid-row-sub{
   width: 100%; 
}
.grid-row-sub {
    height: auto;
}   
        
/*Row 1*/ 
.grid-row:nth-child(1){
  
    margin-top: 50px;
    height: 100px;
}
.grid-row:nth-child(1)>.grid-wrapper{
    height: auto;
    width: 50%;
}
.grid-row:nth-child(1) .grid-block {
    height: 100%;
    width:  90%;
    margin: 0px 5%;
}

        
/*Row 2*/        
.grid-row:nth-child(2){

    margin-top: 50px;
    height: 100px;
}
.grid-row:nth-child(2)>.grid-wrapper{
    height: 100%;
    width: 25%;
    margin-left: 84px;
}
.grid-row:nth-child(2) .grid-block {
    height: 100%;
    width:  90%;
    margin: 0px 5%;
}
.grid-row:nth-child(2)>.grid-wrapper:nth-child(3){
    margin-left: 25px;
}

        
/*Row 3*/        
.grid-row:nth-child(3){
   
    margin-top: 50px;
    height: 100px;
}
.grid-row:nth-child(3)>.grid-wrapper{
    height: 100%;
    width: 25%;
    margin-left: 84px;
}
.grid-row:nth-child(3) .grid-block {
    height: 100%;
    width:  90%;
    margin: 0px 5%;
}
.grid-row:nth-child(3)>.grid-wrapper:nth-child(2){
    margin-left: 325px;
}
        
/*Row 4 */        
.grid-row:nth-child(4){
    height: auto;
    margin-top: 50px;
  
}
.grid-row:nth-child(4)>.grid-wrapper{
    height: auto;
    width: 44%;
    margin-left: 84px;
}
.grid-row:nth-child(4) .grid-block {
    height: auto;
    width:  90%;
    margin: 10% 5%;
}
.grid-row:nth-child(4)>.grid-wrapper:nth-child(1){
    margin-left: 84px;
} 
/*Row 5 */        
.grid-row:nth-child(5){
    height: auto;
    margin-top: 50px;
  
}
.grid-row:nth-child(5)>.grid-wrapper{
    height: auto;
    width: 44%;
    margin-left: 84px;
}
.grid-row:nth-child(5) .grid-block {
    height: auto;
    width:  90%;
    margin: 10% 5%;
}
.grid-row:nth-child(5)>.grid-wrapper:nth-child(1){
    margin-left: 29px;
} 
.grid-row:nth-child(5)>.grid-wrapper:nth-child(2){
   margin-left: 37px;
}  
        
/*Row 6 */        
.grid-row:nth-child(6){
    height: auto;
    margin-top: 50px;
  
}
.grid-row:nth-child(6)>.grid-wrapper{
    height: auto;
    width: 44%;
    margin-left: 84px;
}
.grid-row:nth-child(6) .grid-block {
    height: auto;
    width:  90%;
    margin: 10% 5%;
}
.grid-row:nth-child(6)>.grid-wrapper:nth-child(1){
    margin-left: 29px;
} 
.grid-row:nth-child(6)>.grid-wrapper:nth-child(2){
   margin-left: 37px;
} 

.grid-row:nth-child(6) .grid-wrapper .grid-row-sub{
    height: auto;
    width:  90%;
    margin: 10% 5% 0% 5%;
}   
.grid-row:nth-child(6) .grid-row-sub:nth-child(2) .grid-wrapper{
    width: 50%;
}  
        
 /*Row 7 */        
.grid-row:nth-child(7){
    height: auto;
    margin-top: 50px;
  
}   
.grid-row:nth-child(7)>.grid-wrapper{
    height: auto;
    width: 50%;
}
.grid-row:nth-child(7) .grid-block {
    height: auto;
    width:  98%;
    margin: 0% 1%;
}
.grid-row:nth-child(7) .grid-row-sub .grid-wrapper {
    width: 50%;
}
        /*temp*/
.grid-row:nth-child(7) .grid-wrapper:nth-child(1) .grid-row-sub{
    height: 148px;
}
.grid-row:nth-child(7) .grid-wrapper:nth-child(1) .grid-row-sub:nth-child(2){
    margin: 1% 0% 0% 0%;
}
    </style>
</head>
<body>

<div id="gridContainer" >
   
    <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-block">

            </div>
        </div>
        <div class="grid-wrapper" data-position="fixed">
            <div class="grid-block">

            </div>
        </div>
    </div>
    
     <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-block">

            </div>
        </div>
        <div class="grid-wrapper" data-position="fixed">
            <div class="grid-block">

            </div>
        </div>
        <div class="grid-wrapper">
            <div class="grid-block">

            </div>
        </div>
    </div>  
    
    <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-block">

            </div>
        </div>
        <div class="grid-wrapper">
            <div class="grid-block">
              
            </div>
        </div>
        
    </div>

    <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-block">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin metus nisl, pulvinar id pharetra et, varius at ipsum. Integer sagittis magna vitae turpis consectetur, quis laoreet nulla laoreet. In mi urna, tempus in nibh quis, blandit scelerisque tellus. Proin mattis turpis nec pretium placerat. Morbi nec laoreet urna. Nulla gravida ac sapien vitae pulvinar. 
            </div>
        </div>
        
    </div>
    
    <div class="grid-row">
        <div class="grid-wrapper" data-position="fixed">
            <div class="grid-block">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin metus nisl, pulvinar id pharetra et, varius at ipsum. Integer sagittis magna vitae turpis consectetur, quis laoreet nulla laoreet. In mi urna, tempus in nibh quis, blandit scelerisque tellus. Proin mattis turpis nec pretium placerat. Morbi nec laoreet urna. Nulla gravida ac sapien vitae pulvinar. 
            </div>
        </div>
        <div class="grid-wrapper" data-position="fixed">
            <div class="grid-block">
                <div class="tmp-Element-Form">
                      Contact form
                </div>
               
            </div>
        </div>
    </div>
    
    <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-row-sub">
                <div class="grid-wrapper" data-position="fixed">
                     <div class="grid-block">
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
                     </div>
                </div>
            </div>
            <div class="grid-row-sub">
                <div class="grid-wrapper">
                     <div class="grid-block">
                        Child block btn
                     </div>
                </div>
                <div class="grid-wrapper">
                     <div class="grid-block">
                        Child block btn
                     </div>
                </div>
            </div>
        </div>
        <div class="grid-wrapper">
            <div class="grid-block">
                <div class="tmp-Element-Form">
                      Contact form
                </div>
               
            </div>
        </div>
    </div>
    
    <div class="grid-row">
        <div class="grid-wrapper">
             <div class="grid-row-sub">
                <div class="grid-wrapper">
                     <div class="grid-block" style="height: 100%;">
                       IMG
                     </div>
                </div>
                <div class="grid-wrapper">
                    <div class="grid-block" style="height: 100%;">
                       IMG
                     </div>
                </div>
            </div>
            <div class="grid-row-sub">
                <div class="grid-wrapper">
                     <div class="grid-block" style="height: 100%;">
                       IMG
                     </div>
                </div>
                <div class="grid-wrapper">
                    <div class="grid-block" style="height: 100%;">
                       IMG
                     </div>
                </div>
            </div>
        </div>
        <div class="grid-wrapper">
            <div class="grid-block">
                <div class="tmp-Element-Form">
                      BIG image two column
                </div>
            </div>
        </div>
    </div>
</div>
<div class="hideinBG">
    <div id="bgGridTemporal">
    </div>  
</div>
<script>
   
   columnW(1024,36 );
   resizeGrid();
    
    window.addEventListener('resize', function(){ 
       console.clear();
       resizeGrid();
    });
    
   
// **** Clean func file list **** //

// load bg grid
// func create bg grid - temporal
function columnW(browserwidth, gridCount){
    var browserW = browserwidth, gridC = gridCount;
    var columnwidth = browserW / gridC;
    for ( i = 0; i < gridCount; i++) { 
        var gridContainer = document.getElementById("bgGridTemporal");
        var creatColumn = document.createElement('div');

        creatColumn.style.width= columnwidth;
        creatColumn.style.height= "100%";

        gridContainer.appendChild(creatColumn);   


    }
    return columnwidth;

}
                               
                     

// **** Helper Func **** //

// Clean up nodes
function removeTextNode(nodes){
    return [].filter.call(nodes, function(o){
        return o.nodeType == Node.ELEMENT_NODE;
    });
}
// Remove undiefied vars from array
function cleanUpArray(data){
  data = data.filter(function( element ) {
       return element !== undefined;
  });
  return data;
}
// Map Old wrapper array to new array
function mapWrapperFields(wrappers, wrappersUpdate){
    
    wrappers.forEach(function(item, i) {
                item.dimensions[0] = wrappersUpdate[0][i];
               item.margins[1] = wrappersUpdate[1][i + i]; // right
               item.margins[3] = wrappersUpdate[1][i + i + 1]; // left margin
    })
    return wrappers;
}
    
// Get Object dimensions and set in seperate array dimension;margin;positon
function getObjectDimensions(wrapperID, wraper){

    var wrapperDymations, style, wrapW, wrapH, wrapMTop, wrapMRight, wrapMBottom, wrapMLeft;

    wrapperDymations =[];
    style = wraper.currentStyle || window.getComputedStyle(wraper);
    wrapW = wraper.offsetWidth;
    wrapH = wraper.offsetHeight;

    wrapMTop = parseInt(style.marginTop, 10);
    wrapMRight = parseInt(style.marginRight);
    wrapMBottom = parseInt(style.marginBottom);
    wrapMLeft = parseInt(style.marginLeft);
    
    wrapPos = wraper.getAttribute('data-position');
    if(wrapPos){
       wrapPos = wrapperID;
      wrapperDymations.push.apply(wrapperDymations, [{dimensions: [wrapW,wrapH], margins: [wrapMTop,wrapMRight,wrapMBottom,wrapMLeft], positions: [parseInt(wrapPos)]}])
    }else{
      wrapperDymations.push.apply(wrapperDymations, [{
          dimensions: [wrapW,wrapH], margins: [wrapMTop,wrapMRight,wrapMBottom,wrapMLeft],positions: [] }
            ])}

    return wrapperDymations;

}

// Update Object dimension    
function updateObjectDimensions(wrapperArray, wraper ,wrapperInt){
   console.log(wrapperInt);
   console.log(wrapperArray);
   console.log( wraper);

    console.log(wrapperArray[wrapperInt].margins[0]);
    console.log(wrapperArray[wrapperInt].margins[3]);
   var w = wraper.style;
   w.width = wrapperArray[wrapperInt].dimensions[0];
   w.height = wrapperArray[wrapperInt].dimensions[1];
   w.marginRight  = wrapperArray[wrapperInt].margins[0];
   w.marginLeft  = wrapperArray[wrapperInt].margins[3];

}
// Seperate each rows Object in one dimension object, one margin object, one position object
function getObjectProperties(myObject){
   var properties =  myObject.reduce(function(newObj, item) 
                     {
                      newObj.dimensions.push(item.dimensions[0]);
                      newObj.margins.push(item.margins[1], item.margins[3]);

                      newObj.positions.push(item.positions[0]);
                      return newObj;
                    }, 
                    { dimensions: [], margins: [], positions: []  });
 return properties;
}

    
// Grid Resize 
function resizeGrid(){
    var container = document.getElementById('gridContainer');
    var row =  container.childNodes;
        row =  removeTextNode(row); // now is an array

    var rows = [];

    for (var a in row) {
         var wrapper = row[a].childNodes;
             wrapper = removeTextNode(wrapper); // now is an array
        
            var  rowrInt = [a];
            var rowdimensions = getObjectDimensions(rowrInt, row[a]);
            rows.push.apply(rows,rowdimensions );

            var wrapperArray = [];
            for (var b in wrapper) {
               var  wrapperInt = [b]; // wrapper integer
                wrapDymations = getObjectDimensions(wrapperInt, wrapper[b]);
                wrapperArray.push.apply(wrapperArray,wrapDymations );

            }
          wrappersArrays =  getObjectProperties(wrapperArray); // filter only widths and margins
          var objectfixedIndices = cleanUpArray(wrappersArrays.positions);   


        var resizedBrowser = document.getElementById("bgGridTemporal").offsetWidth;
        //Calculate widths
        var wrappersUpdate = calcWidths(
                                        rowdimensions[0].dimensions[0], // row width
                                        wrappersArrays.dimensions,      // wrappers widths
                                        wrappersArrays.margins,         // wrappers margins
                                        objectfixedIndices,             // Fixed wrapper widths
                                        [],                             // Fixed margins
                                        resizedBrowser                  // New browser width reset
        )

        //Map the updated array with the old array
        mapWrapperFields(wrapperArray, wrappersUpdate);

        //updated the DOM wrappers in that row
        for (var b in wrapper) {
            var  wrapperInt = [b];
             updateObjectDimensions(wrapperArray, wrapper[b],wrapperInt);
        }
    }
}


function calcWidths(rowWidth, wrapperWidths, wrapperMargins, fixedIndexes,fixedMargin, resizedBrowser) {
         console.log('recieved margins', wrapperMargins);
         console.log('recieved widths', wrapperWidths);
         console.error(resizedBrowser);
    
      /*  //filter side margins
        margins = wrapperMargins.filter(function( element, index ) {
              return index % 2 == 1;
        });*/
        
        var initMarginSum = wrapperMargins.reduce(function (prev, cur) {return prev + cur;}, 0);
        var initWidthSum  = wrapperWidths.reduce(function (prev, cur) {return prev + cur;}, 0) ;
        var remainder     = rowWidth - initMarginSum  - initWidthSum;
        
        //var initSum = initMarginSum + initWidthSum + remainder;
        var initSum = 1024; // NEED TO GEt tHE BEFORE RESIZE BROWSER WIDTH.
        var fixedSum = fixedIndexes.reduce(function (prev, cur, index) {return prev + wrapperWidths[cur];}, 0);
        var initRemainingSum = initSum - fixedSum;
        var endRemainingSum = resizedBrowser - fixedSum;
              
        newWidths =  wrapperWidths.map(function(cur, index) {
                     return fixedIndexes.indexOf(index) === -1 ? endRemainingSum*(cur/initRemainingSum) : cur;
                 })
                 
        newMargins =  wrapperMargins.map(function(cur, index) {
                     return fixedMargin.indexOf(index) === -1 ? endRemainingSum*(cur/initRemainingSum) : cur;
                 })       
        console.log('calculated widths', newWidths);
       console.log('calculated margins', newMargins);
       return [newWidths , newMargins ];
}    

</script>
    
    
</body>
</html>
