<html>
<head>
    <style>
        *{margin: 0px; padding: 0px;}       
/* temporal */
.hideinBG{
    position: absolute;z-index: -1;top:0; left:0;
    height: 2200px;width:100%;}
#bgGridTemporal{
    position:relative;
    max-width: 1024px;  margin: 0px auto;
}
#bgGridTemporal div{ 
    display: inline-block; opacity: 0.3;
}
#bgGridTemporal div:nth-child(odd) {
    background-color: brown
}
#bgGridTemporal div:nth-child(even) {
    background-color:beige;
}       
#gridContainer {
    max-width: 1024px; 
    margin: 0px auto;
    background-color: rgba(0,0,0, .1);height: 100%;
}
        
/*Temporal elements*/
.tmp-Element-Form{height: 300px;}
        
/**/
.grid-row    { 
    letter-spacing: -4px;
    background-color: aliceblue; display: inline-block;}
.grid-row-sub  {
letter-spacing: -4px;    
    background-color: rgb(199, 206, 212);display: inline-block;
}
.grid-wrapper{ 
    background-color: #ff0;display: inline-block;vertical-align: top;
    letter-spacing: normal;
}
.grid-wrapper .grid-wrapper{
    background-color: #d7d700;
}
.grid-block  { 
    background-color:aquamarine;display: inline-block;
}
.grid-row, .grid-row-sub{
   width: 100%; 
}
.grid-row-sub {
    height: auto;
}   
        
/*Row 1*/ 
.grid-row:nth-child(1){
  
    margin-top: 50px;
    height: 100px;
}
.grid-row:nth-child(1)>.grid-wrapper{
    height: auto;
    width: 50%;
}
.grid-row:nth-child(1) .grid-block {
    height: 100%;
    width:  90%;
    margin: 0px 5%;
}

        
/*Row 2*/        
.grid-row:nth-child(2){

    margin-top: 50px;
    height: 100px;
}
.grid-row:nth-child(2)>.grid-wrapper{
    height: 100%;
    width: 25%;
    margin-left: 84px;
}
.grid-row:nth-child(2) .grid-block {
    height: 100%;
    width:  90%;
    margin: 0px 5%;
}
.grid-row:nth-child(2)>.grid-wrapper:nth-child(3){
    margin-left: 25px;
}

        
/*Row 3*/        
.grid-row:nth-child(3){
   
    margin-top: 50px;
    height: 100px;
}
.grid-row:nth-child(3)>.grid-wrapper{
    height: 100%;
    width: 25%;
    margin-left: 84px;
}
.grid-row:nth-child(3) .grid-block {
    height: 100%;
    width:  90%;
    margin: 0px 5%;
}
.grid-row:nth-child(3)>.grid-wrapper:nth-child(2){
    margin-left: 325px;
}
        
/*Row 4 */        
.grid-row:nth-child(4){
    height: auto;
    margin-top: 50px;
  
}
.grid-row:nth-child(4)>.grid-wrapper{
    height: auto;
    width: 44%;
    margin-left: 84px;
}
.grid-row:nth-child(4) .grid-block {
    height: auto;
    width:  90%;
    margin: 10% 5%;
}
.grid-row:nth-child(4)>.grid-wrapper:nth-child(1){
    margin-left: 84px;
} 
/*Row 5 */        
.grid-row:nth-child(5){
    height: auto;
    margin-top: 50px;
  
}
.grid-row:nth-child(5)>.grid-wrapper{
    height: auto;
    width: 44%;
    margin-left: 84px;
}
.grid-row:nth-child(5) .grid-block {
    height: auto;
    width:  90%;
    margin: 10% 5%;
}
.grid-row:nth-child(5)>.grid-wrapper:nth-child(1){
    margin-left: 29px;
} 
.grid-row:nth-child(5)>.grid-wrapper:nth-child(2){
   margin-left: 37px;
}  
        
/*Row 6 */        
.grid-row:nth-child(6){
    height: auto;
    margin-top: 50px;
  
}
.grid-row:nth-child(6)>.grid-wrapper{
    height: auto;
    width: 44%;
    margin-left: 84px;
}
.grid-row:nth-child(6) .grid-block {
    height: auto;
    width:  90%;
    margin: 10% 5%;
}
.grid-row:nth-child(6)>.grid-wrapper:nth-child(1){
    margin-left: 29px;
} 
.grid-row:nth-child(6)>.grid-wrapper:nth-child(2){
   margin-left: 37px;
} 

.grid-row:nth-child(6) .grid-wrapper .grid-row-sub{
    height: auto;
    width:  90%;
    margin: 10% 5% 0% 5%;
}   
.grid-row:nth-child(6) .grid-row-sub:nth-child(2) .grid-wrapper{
    width: 50%;
}  
        
 /*Row 7 */        
.grid-row:nth-child(7){
    height: auto;
    margin-top: 50px;
  
}   
.grid-row:nth-child(7)>.grid-wrapper{
    height: auto;
    width: 50%;
}
.grid-row:nth-child(7) .grid-block {
    height: auto;
    width:  98%;
    margin: 0% 1%;
}
.grid-row:nth-child(7) .grid-row-sub .grid-wrapper {
    width: 50%;
}
        /*temp*/
.grid-row:nth-child(7) .grid-wrapper:nth-child(1) .grid-row-sub{
    height: 148px;
}
.grid-row:nth-child(7) .grid-wrapper:nth-child(1) .grid-row-sub:nth-child(2){
    margin: 1% 0% 0% 0%;
}
    </style>
</head>
<body>

<div id="gridContainer" >
   
    <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-block">

            </div>
        </div>
        <div class="grid-wrapper" data-position="fixed">
            <div class="grid-block">

            </div>
        </div>
    </div>
    
     <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-block">

            </div>
        </div>
        <div class="grid-wrapper" data-position="fixed">
            <div class="grid-block">

            </div>
        </div>
        <div class="grid-wrapper">
            <div class="grid-block">

            </div>
        </div>
    </div>  
    
    <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-block">

            </div>
        </div>
        <div class="grid-wrapper">
            <div class="grid-block">
              
            </div>
        </div>
        
    </div>

    <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-block">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin metus nisl, pulvinar id pharetra et, varius at ipsum. Integer sagittis magna vitae turpis consectetur, quis laoreet nulla laoreet. In mi urna, tempus in nibh quis, blandit scelerisque tellus. Proin mattis turpis nec pretium placerat. Morbi nec laoreet urna. Nulla gravida ac sapien vitae pulvinar. 
            </div>
        </div>
        
    </div>
    
    <div class="grid-row">
        <div class="grid-wrapper" data-position="fixed">
            <div class="grid-block">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin metus nisl, pulvinar id pharetra et, varius at ipsum. Integer sagittis magna vitae turpis consectetur, quis laoreet nulla laoreet. In mi urna, tempus in nibh quis, blandit scelerisque tellus. Proin mattis turpis nec pretium placerat. Morbi nec laoreet urna. Nulla gravida ac sapien vitae pulvinar. 
            </div>
        </div>
        <div class="grid-wrapper" data-position="fixed">
            <div class="grid-block">
                <div class="tmp-Element-Form">
                      Contact form
                </div>
               
            </div>
        </div>
    </div>
    
    <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-row-sub">
                <div class="grid-wrapper" data-position="fixed">
                     <div class="grid-block">
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
                     </div>
                </div>
            </div>
            <div class="grid-row-sub">
                <div class="grid-wrapper">
                     <div class="grid-block">
                        Child block btn
                     </div>
                </div>
                <div class="grid-wrapper">
                     <div class="grid-block">
                        Child block btn
                     </div>
                </div>
            </div>
        </div>
        <div class="grid-wrapper">
            <div class="grid-block">
                <div class="tmp-Element-Form">
                      Contact form
                </div>
               
            </div>
        </div>
    </div>
    
    <div class="grid-row">
        <div class="grid-wrapper">
             <div class="grid-row-sub">
                <div class="grid-wrapper">
                     <div class="grid-block" style="height: 100%;">
                       IMG
                     </div>
                </div>
                <div class="grid-wrapper">
                    <div class="grid-block" style="height: 100%;">
                       IMG
                     </div>
                </div>
            </div>
            <div class="grid-row-sub">
                <div class="grid-wrapper">
                     <div class="grid-block" style="height: 100%;">
                       IMG
                     </div>
                </div>
                <div class="grid-wrapper">
                    <div class="grid-block" style="height: 100%;">
                       IMG
                     </div>
                </div>
            </div>
        </div>
        <div class="grid-wrapper">
            <div class="grid-block">
                <div class="tmp-Element-Form">
                      BIG image two column
                </div>
            </div>
        </div>
    </div>
</div>
<div class="hideinBG">
    <div id="bgGridTemporal">
    </div>  
</div>
<script>
   
     
    readDom();

    window.addEventListener('resize', function(){
      readDom();
    });
    
    columnW(1024,36 );
    
    
    
    // Create a temp grid
    function columnW(browserwidth, gridCount){
        var browserW = browserwidth, gridC = gridCount;
        var columnwidth = browserW / gridC;
        for ( i = 0; i < gridCount; i++) { 
            var gridContainer = document.getElementById("bgGridTemporal");
            var creatColumn = document.createElement('div');
            
            creatColumn.style.width= columnwidth;
            creatColumn.style.height= "100%";
            
            gridContainer.appendChild(creatColumn);   
           
           
        }
        return columnwidth;
        
    }
    
    // Clean up nodes
    function removeTextNode(nodes){
        return [].filter.call(nodes, function(o){
            return o.nodeType == Node.ELEMENT_NODE;
        });
    }
    
    // Get wrapper dymation and set in array
    function getWrapperDymantions(wrapperID, wraper){
        
        var wrapperDymations, style, wrapW, wrapH, wrapMTop, wrapMRight, wrapMBottom, wrapMLeft;
        
        wrapperDymations =[];
        style = wraper.currentStyle || window.getComputedStyle(wraper);
        wrapW = wraper.offsetWidth;
        wrapH = wraper.offsetHeight;
    
        wrapMTop = parseInt(style.marginTop, 10);
        wrapMRight = parseInt(style.marginRight);
        wrapMBottom = parseInt(style.marginBottom);
        wrapMLeft = parseInt(style.marginLeft);
        
        wrapPos = wraper.getAttribute('data-position');
        if(wrapPos){
           wrapPos = wrapperID;
          wrapperDymations.push.apply(wrapperDymations, [{dimensions: [wrapW,wrapH], margins: [wrapMTop,wrapMRight,wrapMBottom,wrapMLeft], positions: [parseInt(wrapPos)]}])
        }else{
          wrapperDymations.push.apply(wrapperDymations, [
                                                           {
                                                               dimensions: [wrapW,wrapH], 
                                                               margins: [wrapMTop,wrapMRight,wrapMBottom,wrapMLeft],
                                                               positions: []
                                                           }
                                                        ])
        }
        
        return wrapperDymations;
       
    }
    // func that loop and only get you each wrapper width,and margin left and right
    function getWrapperProperties(myObject){
       var properties =  myObject.reduce(function(newObj, item) 
                         {
                          newObj.dimensions.push(item.dimensions[0]);
                          newObj.margins.push(item.margins[1], item.margins[3]);
                          
                          newObj.positions.push(item.positions[0]);
                          return newObj;
                        }, 
                        { dimensions: [], margins: [], positions: []  });
     return properties;
    }
    // remove undiefied from array
      function cleanUpArray(data){

          data = data.filter(function( element ) {
               return element !== undefined;
          });
          return data;
      }
    
    // Get rows and wrappers
    function readDom(){
        
    
        var container = document.getElementById('gridContainer');
        var row =  container.childNodes;
            row =  removeTextNode(row); // now is an array
        
       
        var rowArray = [];
        
        for (var a in row) {
              var wrapper = row[a].childNodes;
                  wrapper = removeTextNode(wrapper); // now is an array

                  
                var  rowrInt = [b];
                var rowdimensions = getWrapperDymantions(rowrInt, row[a]);
                rowArray.push.apply(rowArray,rowdimensions );
             
            
                var wrapperArray = new Array();
                for (var b in wrapper) {
                    
                    // get wrapper dymantions
                    wrapperInt = [b];
                    wrapDymations = getWrapperDymantions(wrapperInt, wrapper[b]);
                    wrapperArray.push.apply(wrapperArray,wrapDymations );
                  
                }
                   
              wrappersArrays =  getWrapperProperties(wrapperArray); // filter only widths and margins
              var objectfixedIndices = cleanUpArray(wrappersArrays.positions);   
          //   console.log(rowdimensions[0]);
           //  console.log(rowdimensions[0].dimensions[0]); 
        var    wrappersUpdate = calcWidths(rowdimensions[0].dimensions[0],wrappersArrays.dimensions,wrappersArrays.margins, objectfixedIndices, [], 900)
             
               
       
              newWidth = wrappersUpdate[0]; [244,33]
              newMargins = wrappersUpdate[1]; [0,0 ,0,0]
            
            
           //  console.log(newWidth);
            // console.log(newMargins);
            // console.log('test');
               console.log(wrapperArray); 
              console.log(wrappersUpdate); 
            
            
             wrapperArray.forEach(function(item, i) {})
            
           
            
                //update the wrappers
               wrapperArray.forEach(function(item, i) {
                        item.dimensions[0] = newWidth[i];
                       item.margins[1] = newMargins[i + i]; // right
                       item.margins[3] = newMargins[i + i + 1]; // left margin
              })
             
           console.log('After update: ', wrapperArray);
                
        }
        
        
       
        
    }


    function calcWidths(rowWidth, wrapperWidths, wrapperMargins, fixedIndexes,fixedMargin, resizedBrowser) {

      /*  //filter side margins
        margins = wrapperMargins.filter(function( element, index ) {
              return index % 2 == 1;
        });*/
        
        var initMarginSum = wrapperMargins.reduce(function (prev, cur) {return prev + cur;}, 0);
        var initWidthSum  = wrapperWidths.reduce(function (prev, cur) {return prev + cur;}, 0) ;
        var remainder     = rowWidth - initMarginSum  - initWidthSum;
        //Sum of all elemens
        var initSum = initMarginSum + initWidthSum + remainder;
        var fixedSum = fixedIndexes.reduce(function (prev, cur, index) {return prev + wrapperWidths[cur];}, 0);
        var initRemainingSum = initSum - fixedSum;
        var endRemainingSum = resizedBrowser - fixedSum;
              
        newWidth =  wrapperWidths.map(function(cur, index) {
                     return fixedIndexes.indexOf(index) === -1 ? endRemainingSum*(cur/initRemainingSum) : cur;
                 })
                 
        newMargin =  wrapperMargins.map(function(cur, index) {
                     return fixedMargin.indexOf(index) === -1 ? endRemainingSum*(cur/initRemainingSum) : cur;
                 })       
        
        
       return [newWidth , newMargin ];

    }

   
</script>
    
    
</body>
</html>
