<html>
<head>
    <style>
        *{margin: 0px; padding: 0px;}       
/* temporal */
.hideinBG{
    position: absolute;z-index: -1;top:0; left:0;
    height: 2200px;width:100%;}
#bgGridTemporal{
    position:relative;
    max-width: 1024px;  margin: 0px auto;
}
#bgGridTemporal div{ 
    display: inline-block; opacity: 0.3;
}
#bgGridTemporal div:nth-child(odd) {
    background-color: brown
}
#bgGridTemporal div:nth-child(even) {
    background-color:beige;
}       
#gridContainer {
    max-width: 1024px; 
    margin: 0px auto;
    background-color: rgba(0,0,0, .1);height: 100%;
}
        
/*Temporal elements*/
.tmp-Element-Form{height: 300px;}
        
/**/
.grid-row    { 
    background-color: aliceblue; display: inline-block;}
.grid-row-sub  {         
    background-color: rgb(199, 206, 212);display: inline-block;
}
.grid-wrapper{ 
    background-color: #ff0;display: inline-block;vertical-align: top;
}
.grid-wrapper .grid-wrapper{
    background-color: #d7d700;
}
.grid-block  { 
    background-color:aquamarine;display: inline-block;
}
.grid-row, .grid-row-sub{
   width: 100%; 
}
.grid-row-sub {
    height: auto;
}   
        
/*Row 1*/ 
.grid-row:nth-child(1){
  
    margin-top: 50px;
    height: 100px;
}
.grid-row:nth-child(1)>.grid-wrapper{
    height: auto;
    width: 50%;
    margin-left: -2px;
}
.grid-row:nth-child(1)>.grid-wrapper:nth-child(1){
  margin-left: -4px;
}
.grid-row:nth-child(1) .grid-block {
    height: 100%;
    width:  90%;
    margin: 0px 5%;
}

        
/*Row 2*/        
.grid-row:nth-child(2){

    margin-top: 50px;
    height: 100px;
}
.grid-row:nth-child(2)>.grid-wrapper{
    height: 100%;
    width: 25%;
    margin-left: 84px;
}
.grid-row:nth-child(2) .grid-block {
    height: 100%;
    width:  90%;
    margin: 0px 5%;
}
.grid-row:nth-child(2)>.grid-wrapper:nth-child(3){
    margin-left: 25px;
}

        
/*Row 3*/        
.grid-row:nth-child(3){
   
    margin-top: 50px;
    height: 100px;
}
.grid-row:nth-child(3)>.grid-wrapper{
    height: 100%;
    width: 25%;
    margin-left: 84px;
}
.grid-row:nth-child(3) .grid-block {
    height: 100%;
    width:  90%;
    margin: 0px 5%;
}
.grid-row:nth-child(3)>.grid-wrapper:nth-child(2){
    margin-left: 325px;
}
        
/*Row 4 */        
.grid-row:nth-child(4){
    height: auto;
    margin-top: 50px;
  
}
.grid-row:nth-child(4)>.grid-wrapper{
    height: auto;
    width: 44%;
    margin-left: 84px;
}
.grid-row:nth-child(4) .grid-block {
    height: auto;
    width:  90%;
    margin: 10% 5%;
}
.grid-row:nth-child(4)>.grid-wrapper:nth-child(1){
    margin-left: 84px;
} 
/*Row 5 */        
.grid-row:nth-child(5){
    height: auto;
    margin-top: 50px;
  
}
.grid-row:nth-child(5)>.grid-wrapper{
    height: auto;
    width: 44%;
    margin-left: 84px;
}
.grid-row:nth-child(5) .grid-block {
    height: auto;
    width:  90%;
    margin: 10% 5%;
}
.grid-row:nth-child(5)>.grid-wrapper:nth-child(1){
    margin-left: 29px;
} 
.grid-row:nth-child(5)>.grid-wrapper:nth-child(2){
   margin-left: 37px;
}  
        
/*Row 6 */        
.grid-row:nth-child(6){
    height: auto;
    margin-top: 50px;
  
}
.grid-row:nth-child(6)>.grid-wrapper{
    height: auto;
    width: 44%;
    margin-left: 84px;
}
.grid-row:nth-child(6) .grid-block {
    height: auto;
    width:  90%;
    margin: 10% 5%;
}
.grid-row:nth-child(6)>.grid-wrapper:nth-child(1){
    margin-left: 29px;
} 
.grid-row:nth-child(6)>.grid-wrapper:nth-child(2){
   margin-left: 37px;
} 

.grid-row:nth-child(6) .grid-wrapper .grid-row-sub{
    height: auto;
    width:  90%;
    margin: 10% 5% 0% 5%;
}   
.grid-row:nth-child(6) .grid-row-sub:nth-child(2) .grid-wrapper{
    width: 50%;
    margin-left: -2px;
}  
        
 /*Row 7 */        
.grid-row:nth-child(7){
    height: auto;
    margin-top: 50px;
  
}   
.grid-row:nth-child(7)>.grid-wrapper{
    height: auto;
    width: 50%;
    margin-left: -4px;
}
.grid-row:nth-child(7) .grid-block {
    height: auto;
    width:  98%;
    margin: 0% 1%;
}
.grid-row:nth-child(7) .grid-row-sub .grid-wrapper {
    width: 50%;margin-left: -2px;
}
        /*temp*/
.grid-row:nth-child(7) .grid-wrapper:nth-child(1) .grid-row-sub{
    height: 148px;
}
.grid-row:nth-child(7) .grid-wrapper:nth-child(1) .grid-row-sub:nth-child(2){
    margin: 1% 0% 0% 0%;
}
    </style>
</head>
<body>

<div id="gridContainer" >
   
    <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-block">

            </div>
        </div>
        <div class="grid-wrapper" data-position="fixed">
            <div class="grid-block">

            </div>
        </div>
    </div>
    
     <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-block">

            </div>
        </div>
        <div class="grid-wrapper" data-position="fixed">
            <div class="grid-block">

            </div>
        </div>
        <div class="grid-wrapper">
            <div class="grid-block">

            </div>
        </div>
    </div>  
    
    <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-block">

            </div>
        </div>
        <div class="grid-wrapper">
            <div class="grid-block">
              
            </div>
        </div>
        
    </div>

    <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-block">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin metus nisl, pulvinar id pharetra et, varius at ipsum. Integer sagittis magna vitae turpis consectetur, quis laoreet nulla laoreet. In mi urna, tempus in nibh quis, blandit scelerisque tellus. Proin mattis turpis nec pretium placerat. Morbi nec laoreet urna. Nulla gravida ac sapien vitae pulvinar. 
            </div>
        </div>
        
    </div>
    
    <div class="grid-row">
        <div class="grid-wrapper" data-position="fixed">
            <div class="grid-block">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin metus nisl, pulvinar id pharetra et, varius at ipsum. Integer sagittis magna vitae turpis consectetur, quis laoreet nulla laoreet. In mi urna, tempus in nibh quis, blandit scelerisque tellus. Proin mattis turpis nec pretium placerat. Morbi nec laoreet urna. Nulla gravida ac sapien vitae pulvinar. 
            </div>
        </div>
        <div class="grid-wrapper" data-position="fixed">
            <div class="grid-block">
                <div class="tmp-Element-Form">
                      Contact form
                </div>
               
            </div>
        </div>
    </div>
    
    <div class="grid-row">
        <div class="grid-wrapper">
            <div class="grid-row-sub">
                <div class="grid-wrapper" data-position="fixed">
                     <div class="grid-block">
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. 
                     </div>
                </div>
            </div>
            <div class="grid-row-sub">
                <div class="grid-wrapper">
                     <div class="grid-block">
                        Child block btn
                     </div>
                </div>
                <div class="grid-wrapper">
                     <div class="grid-block">
                        Child block btn
                     </div>
                </div>
            </div>
        </div>
        <div class="grid-wrapper">
            <div class="grid-block">
                <div class="tmp-Element-Form">
                      Contact form
                </div>
               
            </div>
        </div>
    </div>
    
    <div class="grid-row">
        <div class="grid-wrapper">
             <div class="grid-row-sub">
                <div class="grid-wrapper">
                     <div class="grid-block" style="height: 100%;">
                       IMG
                     </div>
                </div>
                <div class="grid-wrapper">
                    <div class="grid-block" style="height: 100%;">
                       IMG
                     </div>
                </div>
            </div>
            <div class="grid-row-sub">
                <div class="grid-wrapper">
                     <div class="grid-block" style="height: 100%;">
                       IMG
                     </div>
                </div>
                <div class="grid-wrapper">
                    <div class="grid-block" style="height: 100%;">
                       IMG
                     </div>
                </div>
            </div>
        </div>
        <div class="grid-wrapper">
            <div class="grid-block">
                <div class="tmp-Element-Form">
                      BIG image two column
                </div>
            </div>
        </div>
    </div>
</div>
<div class="hideinBG">
    <div id="bgGridTemporal">
    </div>  
</div>
<script>
   
    // Create a temp grid
    function columnW(browserwidth, gridCount){
        var browserW = browserwidth, gridC = gridCount;
        var columnwidth = browserW / gridC;
        for ( i = 0; i < gridCount; i++) { 
            var gridContainer = document.getElementById("bgGridTemporal");
            var creatColumn = document.createElement('div');
            
            creatColumn.style.width= columnwidth;
            creatColumn.style.height= "100%";
            
            gridContainer.appendChild(creatColumn);   
           
           
        }
        return columnwidth;
        
    }
    
    // Clean up nodes
    function removeTextNode(nodes){
        return [].filter.call(nodes, function(o){
            return o.nodeType == Node.ELEMENT_NODE;
        });
    }
    
    // Get wrapper dymation and set in array
    function getWrapperDymantions(wrapperID, wraper){
        
        var wrapperDymations, style, wrapW, wrapH, wrapMTop, wrapMRight, wrapMBottom, wrapMLeft;
        
        wrapperDymations =[];
        style = wraper.currentStyle || window.getComputedStyle(wraper);
        wrapW = wraper.offsetWidth;
        wrapH = wraper.offsetHeight;
    
        wrapMTop = parseInt(style.marginTop, 10);
        wrapMRight = parseInt(style.marginRight);
        wrapMBottom = parseInt(style.marginBottom);
        wrapMLeft = parseInt(style.marginLeft);
        
        wrapPos = wraper.getAttribute('data-position');
        if(wrapPos){
           wrapPos = wrapperID;
          wrapperDymations.push.apply(wrapperDymations, [{dimensions: [wrapW,wrapH], margins: [wrapMTop,wrapMRight,wrapMBottom,wrapMLeft], positions: [parseInt(wrapPos)]}])
        }else{
          wrapperDymations.push.apply(wrapperDymations, [
                                                           {
                                                               dimensions: [wrapW,wrapH], 
                                                               margins: [wrapMTop,wrapMRight,wrapMBottom,wrapMLeft],
                                                               positions: []
                                                           }
                                                        ])
        }
 
        return wrapperDymations;
       
    }
    
    function getWrapperProperties(myObject){
       var properties =  myObject.reduce(function(newObj, item) 
                         {
                          newObj.dimensions.push(item.dimensions[0]);
                          newObj.margins.push(item.margins[1], item.margins[3]);
                          
                          newObj.positions.push(item.positions[0]);
                          return newObj;
                        }, 
                        { dimensions: [], margins: [], positions: []  });
     return properties;
    }
    // remove undiefied from array
      function cleanUpArray(data){

          data = data.filter(function( element ) {
               return element !== undefined;
          });
          return data;
      }
    
    // Get rows and wrappers
    function readDom(){
        
        var container = document.getElementById('gridContainer');
        var row =  container.childNodes;
            row =  removeTextNode(row); // now is an array
        
       
        var rowArray = new Array();
        
        for (var a in row) {
              var wrapper = row[a].childNodes;
                  wrapper = removeTextNode(wrapper); // now is an array
                  
                var  rowrInt = [b];
                var rowdimensions = getWrapperDymantions(rowrInt, row[a]);
                rowArray.push.apply(rowArray,rowdimensions );
             
            
                var wrapperArray = new Array();
                for (var b in wrapper) {
                    
                    // get wrapper dymantions
                    wrapperInt = [b];
                    wrapDymations = getWrapperDymantions(wrapperInt, wrapper[b]);
                    
                    //wrapperArray.push.apply(wrapperArray, [wrapDymations[0], wrapDymations[3], wrapDymations[5]]);
                    wrapperArray.push.apply(wrapperArray,wrapDymations );
                    console.log('wrapper array');
                    
                    console.log(wrapperArray);
                    
                 
                 }
            
                 // Calculate new widths
                 var calcNewWrapDymations = calwidth( rowArray, wrapperArray  );
        }
        
        
       
        
    }
    function calMargin(){
        
    }
    // Calculates div sizes
    function calwidth( row, wrappers ) {
       //  vals, fixedIndices, newSum
       
       var wrapperProperties = getWrapperProperties(wrappers);
        
       var rowProperties = getWrapperProperties(row);
       var rowWidth = rowProperties.dimensions[0];
        
       var valsWrapper = wrapperProperties.dimensions;
       var valsMargin = wrapperProperties.margins;
       var objectfixedIndices = cleanUpArray(wrapperProperties.positions);
        
       var remainder = rowWidth - (valsWrapper.reduce((a, b) => a + b, 0) + valsMargin.reduce((a, b) => a + b, 0)); // the space of last element
        
     
        var containerWidth = valsWrapper.reduce((a, b) => a + b, 0) + valsMargin.reduce((a, b) => a + b, 0);
       
        
        console.log(valsWrapper); 
        console.log(valsMargin);
        console.log(objectfixedIndices);
        console.log(remainder);
        
        
        // FUNCTIONS TO WRITE
        // Check if there is a remainder 
        
            // than need to check if not all elements are fixed, 
                // if are, than reduce all propotion
                 
                    // if not than 
                        // Check if margin sum is more than 0 
                                //if it is than  reduce margin
                                    // Check if wrappers are not too small 
                                        // if theyh are not too small than reduce them 
                                        
                
            
        
        
        /*
        wrappers.prototype.filterObjects = function(id, value) {
            return this.filter(function(x) { return x[id] === value; })
        }
        
       // if all elements sum = to browser and fixed than all reduced equaly
       if(vals.reduce((a, b) => a + b, 0) && vals.length  == fixedIndices.length ){
           var fixedIndices =[];
       }
      var initSum = vals.reduce(function (prev, cur) {return prev + cur;}, 0);
      var fixedSum = fixedIndices.reduce(function (prev, cur, index) {return prev + vals[cur];}, 0);
      var initRemainingSum = initSum - fixedSum;
      var endRemainingSum = newSum - fixedSum;
      return vals.map(function(cur, index) {return fixedIndices.indexOf(index) === -1 ? endRemainingSum*(cur/initRemainingSum) : cur;})
      */
    }

 
 
     
    //var OneColumn = columnW();
   // console.log(columnW(1024,36 ));
    
    readDom();
     columnW(1024,36 );
    
</script>
    
    
</body>
</html>
